<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  </head>
  <body>
    <script type="module">
      if ("serviceWorker" in navigator) {
        // TODO: registrations = await navigator.serviceWorker.getRegistrations()
        navigator.serviceWorker
          .register("/swenc-proxy-sw.js", { type: "module" })
          .then((registration) => {
            console.log("ServiceWorker registered", registration);
          })
          .catch((error) => {
            console.error("ServiceWorker registration failed: ", error);
            if (navigator.userAgent.toLowerCase().includes("firefox")) {
              alert(`ERROR: ServiceWorker registration failed!
Since you are on Firefox, this may be due to missing 'import' support in ServiceWorkers. Please try a Chromium-based browser instead.
(https://caniuse.com/mdn-javascript_statements_import_service_worker_support)`);
            }
          });
      }

      navigator.serviceWorker.ready.then((registration) => {
        const script = document.createElement("script");
        script.src = "/swenc-proxy/prison.js";
        document.head.appendChild(script);
      });

      document.getElementById("form").addEventListener("submit", (event) => {
        event.preventDefault();
        const url = event.target.url.value;
        location.href = url;
      });
    </script>
    <form id="form">
      <label for="url">URL:</label>
      <input name="url" type="text" value="https://example.com" />
      <button type="submit">Go!</button>
    </form>
  </body>
</html>
